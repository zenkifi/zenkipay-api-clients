# This GitHub Actions workflow was generated by the `Zenkipay team` on 2023-01-27
name: GitHub Action for Zenkipay API Clients SDKs

on:
  push:
    branches:
      # This workflow will run every time you push code to the following branch: `main`
      # Check out GitHub's docs for more info on configuring this:
      # https://docs.github.com/actions/using-workflows/events-that-trigger-workflows
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout local repository zenkipay-api-clients-sdk
        uses: actions/checkout@v3

      - name: Checkout repository zenkipay-api
        uses: actions/checkout@v3
        with:
          repository: zenkifi/zenkipay-api
          path: zenkipay-api

      - name: Actualizando especificación de Zenkipay API
        run: |
          echo "HOME -> $HOME"
          echo "GITHUB_PATH -> $GITHUB_PATH"
          echo "Borrando archivo de especificación"
          rm src/main/resources/Zenkipay-API-v1-EN.yaml
          echo "Actualizando archivo de especificación"
          ls -la src/main/resources/
          cp zenkipay-api/Zenkipay-API-v1-ES.yaml src/main/resources/
          ls -la src/main/resources/
          pwd

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Ejecutando Gradlew para generar los SDK's
        uses: gradle/gradle-build-action@v2
        with:
          gradle-version: release-candidate
          arguments: -b build-java.gradle clean openApiValidate openApiGenerate changePermission

      - name: SDK Java - Ejecutando maven para generar librerías de cliente
        run: |
          echo "Actual Path"
          cd build/zenkipay-sdk/java/
          echo "Ejecutando Maven"
          mvn clean compile package --file pom.xml

      - name: SDK Java - Moviendo artefactos a directorio de liberaciones
        run: |
          echo "Actual Path"
          pwd
          echo "Creando directorio con la versión por liberar"
          mkdir Release/SDK Java/v1.0.0
          echo "Ejecutando Maven"
          cd build/zenkipay-sdk/java/
          mvn clean compile package --file pom.xml
          echo "Moviendo artefactos para hacer commit"
          cp target/zenkipay-api-client-1.0.0-RELEASE.jar ../../../Release/SDK Java/v1.0.0/
          cp target/zenkipay-api-client-1.0.0-RELEASE-javadoc.jar ./../../Release/SDK Java/v1.0.0/
          pwd
          ls -la

      - name: Subiendo librerías de SDK Java
        run: |
          date > generated.txt
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add target/zenkipay-api-client-1.0.0-RELEASE.jar
          git add target/zenkipay-api-client-1.0.0-RELEASE-javadoc.jar
          git commit -m "Se suben cambios a clientes SDK por cambios en la especificación de API"
          git push